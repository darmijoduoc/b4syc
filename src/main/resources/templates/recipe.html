<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Receta</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css"/>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="bg-gray-100">
<div class="content-fluid" style="min-height: 100vh">
    <div class="container mx-auto px-4 py-4">

        <nav class="navbar shadow-md px-6 text-white" style="background-color:#10935a;">
            <div class="flex justify-between items-center w-full">
                <div class="breadcrumbs text-sm">
                    <ul>
                        <li>
                            <a class="text-white hover:underline" href="/">Grupo
                                4</a>
                        </li>
                        <li th:text="${recipe.title}"></li>
                    </ul>
                </div>
            </div>
        </nav>
        <main class="flex-grow container mx-auto px-4 py-10">
            <div class="card bg-base-100 shadow-xl max-w-3xl mx-auto">
                <div class="carousel rounded-box h-64">
                    <div class="carousel-item" th:each="image : ${recipe.images}">
                        <img th:src="@{${image.url}}" th:alt="${image.description}"/>
                    </div>
                </div>


                <div class="card-body pt-0">
                    <h1 class="text-2xl font-bold text-gray-800" th:text="${recipe.title}"></h1>
                    <p class="text-gray-600" th:text="${recipe.description}"></p>
                    <p class="text-gray-600" th:text="${recipe.rating}"></p>
                    <div class="rating">
                        <input type="radio" value="1"
                               class="mask mask-star-2" aria-label="1 star"
                               th:classappend="${recipe.rating} >= 1 ? ' bg-orange-400' : ' bg-gray-300'"
                               th:checked="${recipe.rating} == 1" disabled/>
                        <input type="radio" value="2"
                               class="mask mask-star-2" aria-label="2 star"
                               th:classappend="${recipe.rating} >= 2 ? ' bg-orange-400' : ' bg-gray-300'"
                               th:checked="${recipe.rating} == 2" disabled/>
                        <input type="radio" value="3"
                               class="mask mask-star-2" aria-label="3 star"
                               th:classappend="${recipe.rating} >= 3 ? ' bg-orange-400' : ' bg-gray-300'"
                               th:checked="${recipe.rating} == 3" disabled/>
                        <input type="radio" value="4"
                               class="mask mask-star-2" aria-label="4 star"
                               th:classappend="${recipe.rating} >= 4 ? ' bg-orange-400' : ' bg-gray-300'"
                               th:checked="${recipe.rating} == 4" disabled/>
                        <input type="radio" value="5"
                               class="mask mask-star-2" aria-label="5 star"
                               th:classappend="${recipe.rating} >= 5 ? ' bg-orange-400' : ' bg-gray-300'"
                               th:checked="${recipe.rating} == 5" disabled/>

                    </div>


                    <h2 class="font-bold text-lg text-gray-700 mt-6">Ingredientes</h2>
                    <ul class="divide-y divide-[color:#7a2f25]">
                        <li class="py-2" th:each="ingredient : ${recipe.ingredients}"
                            th:text=" ${ingredient.amount} + ' ' + ${ingredient.unit} + ' de ' + ${ingredient.name}"></li>
                    </ul>


                    <h2 class="font-bold text-lg text-gray-700 mt-8">Preparación</h2>
                    <ol class="list-none pl-0 mt-2">
                        <li class="relative pl-9 my-2"
                            th:each="step,iter : ${recipe.steps}">
                            <span class="absolute left-0 top-0 font-bold text-teal-700"
                                  th:text="${iter.index + 1} + '.'"></span>
                            <span th:text="${step.description}"></span>
                        </li>
                    </ol>

                    <h2 class="font-bold text-lg text-gray-700 mt-8">Comentarios</h2>
                    <ul class="list bg-base-100">

                        <li class="list-row" th:each="comment,iter : ${recipe.comments}">
                            <div><img class="size-10 rounded-box"
                                      th:src="'https://api.dicebear.com/9.x/adventurer/svg?seed=' + ${comment.author}"/>
                            </div>
                            <div>
                                <div th:text="${comment.author}"></div>
                                <div th:text="${comment.formattedCreatedAt}"></div>
                            </div>
                            <p class="list-col-wrap text-xs" th:text="${comment.text}"></p>
                            <div class="rating">
                                <input type="radio" value="1"
                                       class="mask mask-star-2" aria-label="1 star"
                                       th:classappend="${comment.rating} >= 1 ? ' bg-orange-400' : ' bg-gray-300'"
                                       th:checked="${comment.rating} == 1" disabled/>
                                <input type="radio" value="2"
                                       class="mask mask-star-2" aria-label="2 star"
                                       th:classappend="${comment.rating} >= 2 ? ' bg-orange-400' : ' bg-gray-300'"
                                       th:checked="${comment.rating} == 2" disabled/>
                                <input type="radio" value="3"
                                       class="mask mask-star-2" aria-label="3 star"
                                       th:classappend="${comment.rating} >= 3 ? ' bg-orange-400' : ' bg-gray-300'"
                                       th:checked="${comment.rating} == 3" disabled/>
                                <input type="radio" value="4"
                                       class="mask mask-star-2" aria-label="4 star"
                                       th:classappend="${comment.rating} >= 4 ? ' bg-orange-400' : ' bg-gray-300'"
                                       th:checked="${comment.rating} == 4" disabled/>
                                <input type="radio" value="5"
                                       class="mask mask-star-2" aria-label="5 star"
                                       th:classappend="${comment.rating} >= 5 ? ' bg-orange-400' : ' bg-gray-300'"
                                       th:checked="${comment.rating} == 5" disabled/>
                            </div>

                        </li>
                    </ul>

                    <form th:action="@{/recipe/{ulid}/comments(ulid=${recipe.ulid})}" method="post" class="w-full mt-4">
                        <div class="rating">
                            <input type="radio" name="rating" value="1" class="mask mask-star-2 bg-orange-400"
                                   aria-label="1 star"/>
                            <input type="radio" name="rating" value="2" class="mask mask-star-2 bg-orange-400"
                                   aria-label="2 star"/>
                            <input type="radio" name="rating" value="3" class="mask mask-star-2 bg-orange-400"
                                   aria-label="3 star"/>
                            <input type="radio" name="rating" value="4" class="mask mask-star-2 bg-orange-400"
                                   aria-label="4 star"/>
                            <input type="radio" name="rating" value="5" class="mask mask-star-2 bg-orange-400"
                                   aria-label="5 star"/>
                        </div>
                        <div class="form-control mt-2">
                            <label class="label"><span class="label-text">Comentario</span></label>
                            <textarea name="comment" rows="3" class="textarea textarea-bordered w-full"
                                      placeholder="Escribe tu comentario..." required></textarea>
                        </div>
                        <div class="flex justify-end mt-3">
                            <button type="submit" class="btn btn-sm" style="background-color:#0ac472; color:white;">
                                Comentar
                            </button>
                        </div>
                    </form>


                    <div class="card-actions justify-end mt-6">

                        <label for="my_modal_7" class="btn btn-sm">Ver link para compartir</label>

                        <!-- Put this part before </body> tag -->
                        <input type="checkbox" id="my_modal_7" class="modal-toggle"/>
                        <div class="modal" role="dialog">
                            <div class="modal-box">
                                <h3 class="text-lg font-bold">Link para compartir</h3>
                                <a class="link"
                                   style="word-break: break-all"
                                   target="_blank"
                                   th:text="${baseUrl} +'/shared_recipe/' + ${recipe.ulid} + '?jwt=' + ${jwt}"
                                   th:href="${baseUrl} +'/shared_recipe/' + ${recipe.ulid} + '?jwt=' + ${jwt}">
                                </a>
                            </div>
                            <label class="modal-backdrop" for="my_modal_7">Close</label>
                        </div>
                        <a class="btn btn-sm border-none text-white " style="background-color:#0ac472;"
                           th:href="@{/recipes}">
                            Volver a Recetas
                        </a>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
<footer class="text-center py-4 mt-auto text-white" style="background-color:#2e463b;">
    <p class="text-sm">© 2025 Grupo 14</p>
</footer>
</body>